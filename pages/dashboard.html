<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Club Management System</title>
    <link rel="stylesheet" href="../css/style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Oswald:wght@500;700&display=swap"
        rel="stylesheet">
</head>

<body class="app-body">
    <!-- Sidebar injected by app.js -->

    <main class="main-content fade-in">
        <header class="section-header" style="margin-top: 0">
            <div>
                <h1>Dashboard</h1>
                <p style="color: var(--text-muted)">Welcome back to your club overview.</p>
            </div>
            <div id="date-display" class="glass-card" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                <!-- Date JS -->
            </div>
        </header>

        <!-- Stats Row -->
        <div class="dashboard-grid">
            <div class="glass-card stat-card">
                <span class="stat-label">Total Members</span>
                <span class="stat-value" id="total-members">0</span>
            </div>
            <div class="glass-card stat-card">
                <span class="stat-label">Upcoming Events</span>
                <span class="stat-value" id="total-events">0</span>
            </div>
            <div class="glass-card stat-card">
                <span class="stat-label">Total Funds</span>
                <span class="stat-value" style="color: var(--accent)" id="total-funds">$0</span>
            </div>
        </div>

        <div class="content-grid">
            <!-- Recent Announcements -->
            <section>
                <div class="section-header">
                    <h3>Recent Announcements</h3>
                </div>
                <div id="announcements-list" style="display: flex; flex-direction: column; gap: 1rem;">
                    <!-- Dynamic Content -->
                </div>
            </section>

            <!-- Upcoming Event Preview -->
            <section>
                <div class="section-header">
                    <h3>Next Event</h3>
                </div>
                <div id="next-event-card" class="glass-card"
                    style="padding: 1.5rem; border-left: 4px solid var(--secondary);">
                    <!-- Dynamic Content -->
                    <p class="text-muted">No upcoming events.</p>
                </div>
            </section>
        </div>
    </main>

    <script src="../js/storage.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Load Date
            const now = new Date();
            document.getElementById('date-display').textContent = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

            // Load Stats
            const members = Storage.get(DB_KEYS.MEMBERS) || [];
            const events = Storage.get(DB_KEYS.EVENTS) || [];
            const funds = Storage.get(DB_KEYS.FUNDS) || [];
            const announcements = Storage.get(DB_KEYS.ANNOUNCEMENTS) || [];

            document.getElementById('total-members').textContent = members.length;
            document.getElementById('total-events').textContent = events.filter(e => new Date(e.date) >= new Date()).length;

            const balance = funds.reduce((acc, curr) => {
                return curr.type === 'income' ? acc + curr.amount : acc - curr.amount;
            }, 0);
            document.getElementById('total-funds').textContent = `$${balance.toLocaleString()}`;

            // Load Announcements (Top 3)
            const list = document.getElementById('announcements-list');
            if (announcements.length === 0) {
                list.innerHTML = '<p style="color: var(--text-muted)">No announcements yet.</p>';
            } else {
                announcements.slice(0, 3).forEach(ann => {
                    const item = document.createElement('div');
                    item.className = 'glass-card';
                    item.style.padding = '1rem';
                    item.innerHTML = `
                        <h4 style="margin-bottom: 0.5rem; color: var(--primary)">${ann.title}</h4>
                        <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.5rem">${ann.content}</p>
                        <small style="font-size: 0.75rem; opacity: 0.7">${new Date(ann.date).toLocaleDateString()}</small>
                    `;
                    list.appendChild(item);
                });
            }

            // Load Next Event
            const upcomingEvents = events
                .filter(e => new Date(e.date) >= new Date())
                .sort((a, b) => new Date(a.date) - new Date(b.date));

            if (upcomingEvents.length > 0) {
                const next = upcomingEvents[0];
                const card = document.getElementById('next-event-card');
                card.innerHTML = `
                    <h4 style="font-size: 1.25rem; margin-bottom: 0.5rem">${next.title}</h4>
                    <p style="margin-bottom: 0.5rem"><span style="color: var(--secondary)">üìÖ</span> ${new Date(next.date).toLocaleDateString()}</p>
                    <p style="margin-bottom: 1rem"><span style="color: var(--secondary)">üìç</span> ${next.venue}</p>
                    <p style="font-size: 0.9rem; color: var(--text-muted)">${next.description}</p>
                    <a href="events.html" class="btn btn-primary" style="margin-top: 1rem; width: 100%">View Details</a>
                `;
            }
        });
    </script>
</body>

</html>